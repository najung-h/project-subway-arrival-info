services:
  web:
    image: ${APP_IMAGE}              # ← 여기만 변수로 주입
    env_file:
      - ../.env
    command: ["gunicorn","config.wsgi:application","-b","0.0.0.0:8000","-w","3"]
    volumes:
      - static_volume:/app/staticfiles
    networks: [app_net]
    restart: unless-stopped

  nginx:
    image: nginx:1.27                # 고정 이미지 (치환 금지)
    ports: ["80:80"]
    volumes:
      - static_volume:/static
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on: [web]
    networks: [app_net]
    restart: unless-stopped

volumes:
  static_volume:

networks:
  app_net:
